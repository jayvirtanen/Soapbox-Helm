"use strict";(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[63],{812:function(e,t,s){s.r(t),s.d(t,{default:function(){return U}});var a,o,i,n,r,c,d,u,l,p,f,h,m,_=s(1019),g=s(1018),Z=(s(1),s(3)),y=s.n(Z),b=s(548),v=s.n(b),M=s(0),w=s(5),C=s.n(w),P=s(4),k=s(1797),N=s(1017),S=s(1021),F=s(2),q=s(1794),j=s(30),D=s(35),I=s(1259),O=s(223),R=s(28),T=s(395),x=s(16),E=s(1024),L=(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}),A=(0,k.vU)({heading:{id:"column.security",defaultMessage:"Security"},subheading:{id:"column.mfa",defaultMessage:"Multi-Factor Authentication"},mfa_cancel_button:{id:"column.mfa_cancel",defaultMessage:"Cancel"},mfa_setup_button:{id:"column.mfa_setup",defaultMessage:"Proceed to Setup"},mfa_setup_confirm_button:{id:"column.mfa_confirm_button",defaultMessage:"Confirm"},mfa_setup_disable_button:{id:"column.mfa_disable_button",defaultMessage:"Disable"},passwordFieldLabel:{id:"security.fields.password.label",defaultMessage:"Password"},confirmFail:{id:"security.confirm.fail",defaultMessage:"Incorrect code or password. Try again."},qrFail:{id:"security.qr.fail",defaultMessage:"Failed to fetch setup key"},codesFail:{id:"security.codes.fail",defaultMessage:"Failed to fetch backup codes"},disableFail:{id:"security.disable.fail",defaultMessage:"Incorrect password. Try again."},mfaDisableSuccess:{id:"mfa.disable.success_message",defaultMessage:"MFA disabled"},mfaConfirmSuccess:{id:"mfa.confirm.success_message",defaultMessage:"MFA confirmed"},codePlaceholder:{id:"mfa.mfa_setup.code_placeholder",defaultMessage:"Code"},passwordPlaceholder:{id:"mfa.mfa_setup.password_placeholder",defaultMessage:"Password"}}),U=(0,F.$j)((function(e){return{backup_codes:e.getIn(["auth","backup_codes","codes"]),mfa:e.getIn(["security","mfa"])}}))(f=(0,N.ZP)(f=(0,q.EN)((m=h=function(e){function t(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var a=e.apply(this,t)||this;return(0,g.Z)(a,"state",{displayOtpForm:!1}),(0,g.Z)(a,"handleSetupProceedClick",(function(e){a.setState({displayOtpForm:!0}),e.preventDefault()})),a}return L(t,e),t.prototype.componentDidMount=function(){this.props.dispatch((0,T.PD)())},t.prototype.render=function(){var e=this.props,t=e.intl,s=e.mfa,a=this.state.displayOtpForm;return(0,_.Z)(x.Z,{icon:"lock",heading:t.formatMessage(A.heading)},void 0,(0,_.Z)(E.Z,{text:t.formatMessage(A.subheading)}),s.getIn(["settings","totp"])?(0,_.Z)($,{}):M.createElement(M.Fragment,null,(0,_.Z)(B,{handleSetupProceedClick:this.handleSetupProceedClick}),a&&(0,_.Z)(H,{})))},t}(P.ZP),(0,g.Z)(h,"propTypes",{intl:y().object.isRequired,dispatch:y().func.isRequired,mfa:C().map.isRequired,history:y().object}),f=m))||f)||f)||f,$=(0,F.$j)()(o=(0,N.ZP)(o=(0,q.EN)((n=i=function(e){function t(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var a=e.apply(this,t)||this;return(0,g.Z)(a,"state",{password:"",isLoading:!1}),(0,g.Z)(a,"handleInputChange",(function(e){var t;a.setState(((t={})[e.target.name]=e.target.value,t))})),(0,g.Z)(a,"handleSubmit",(function(e){var t=a.state.password,s=a.props,o=s.dispatch,i=s.intl;a.setState({isLoading:!0}),o((0,T.B2)("totp",t)).then((function(){o(j.ZP.success(i.formatMessage(A.mfaDisableSuccess))),a.props.history.push("../auth/edit")})).catch((function(e){o(j.ZP.error(i.formatMessage(A.disableFail))),a.setState({isLoading:!1})})),e.preventDefault()})),a}return L(t,e),t.prototype.render=function(){var e=this.props.intl,t=this.state,s=t.isLoading,a=t.password;return(0,_.Z)("div",{className:"security-settings-panel"},void 0,(0,_.Z)(R.NA,{onSubmit:this.handleSubmit,disabled:s},void 0,(0,_.Z)("h1",{className:"security-settings-panel__setup-otp"},void 0,(0,_.Z)(S.Z,{id:"mfa.otp_enabled_title",defaultMessage:"OTP Enabled"})),(0,_.Z)("h2",{className:"security-settings-panel__setup-otp"},void 0,(0,_.Z)(S.Z,{id:"mfa.otp_enabled_description",defaultMessage:"You have enabled two-factor authentication via OTP."})),(0,_.Z)(O.Z,{label:e.formatMessage(A.passwordPlaceholder),placeholder:e.formatMessage(A.passwordPlaceholder),hint:(0,_.Z)(S.Z,{id:"mfa.mfa_disable_enter_password",defaultMessage:"Enter your current password to disable two-factor auth."}),disabled:s,name:"password",onChange:this.handleInputChange,value:a,required:!0}),(0,_.Z)("div",{className:"security-settings-panel__setup-otp__buttons"},void 0,(0,_.Z)(D.Z,{disabled:s,className:"button button-primary disable",text:e.formatMessage(A.mfa_setup_disable_button)}))))},t}(P.ZP),(0,g.Z)(i,"propTypes",{intl:y().object.isRequired,dispatch:y().func.isRequired,history:y().object}),o=n))||o)||o)||o,B=(0,F.$j)()(r=(0,N.ZP)(r=(0,q.EN)((d=c=function(e){function t(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var a=e.apply(this,t)||this;return(0,g.Z)(a,"state",{backupCodes:[]}),(0,g.Z)(a,"handleCancelClick",(function(e){a.props.history.push("../auth/edit"),e.preventDefault()})),a}return L(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,s=t.dispatch,a=t.intl;s((0,T.uD)()).then((function(t){var s=t.codes;e.setState({backupCodes:s})})).catch((function(e){s(j.ZP.error(a.formatMessage(A.codesFail)))}))},t.prototype.render=function(){var e=this.props.intl,t=this.state,s=t.backupCodes,a=t.displayOtpForm;return(0,_.Z)("div",{className:"security-settings-panel"},void 0,(0,_.Z)(R.NA,{},void 0,(0,_.Z)("h1",{className:"security-settings-panel__setup-otp"},void 0,(0,_.Z)(S.Z,{id:"mfa.setup_otp_title",defaultMessage:"OTP Disabled"})),(0,_.Z)("h2",{className:"security-settings-panel__setup-otp"},void 0,(0,_.Z)(S.Z,{id:"mfa.setup_hint",defaultMessage:"Follow these steps to set up multi-factor authentication on your account with OTP"})),(0,_.Z)("div",{className:"security-warning"},void 0,(0,_.Z)(S.Z,{id:"mfa.setup_warning",defaultMessage:"Write these codes down or save them somewhere secure - otherwise you won't see them again. If you lose access to your 2FA app and recovery codes you'll be locked out of your account."})),(0,_.Z)("h2",{className:"security-settings-panel__setup-otp"},void 0,(0,_.Z)(S.Z,{id:"mfa.setup_recoverycodes",defaultMessage:"Recovery codes"})),(0,_.Z)("div",{className:"backup_codes"},void 0,s.length>0?(0,_.Z)("div",{},void 0,s.map((function(e,t){return(0,_.Z)("div",{className:"backup_code"},t,(0,_.Z)("div",{className:"backup_code"},void 0,e))}))):(0,_.Z)(I.Z,{})),!a&&(0,_.Z)("div",{className:"security-settings-panel__setup-otp__buttons"},void 0,(0,_.Z)(D.Z,{className:"button button-secondary cancel",text:e.formatMessage(A.mfa_cancel_button),onClick:this.handleCancelClick}),s.length>0&&(0,_.Z)(D.Z,{className:"button button-primary setup",text:e.formatMessage(A.mfa_setup_button),onClick:this.props.handleSetupProceedClick}))))},t}(P.ZP),(0,g.Z)(c,"propTypes",{intl:y().object.isRequired,dispatch:y().func.isRequired,history:y().object}),r=d))||r)||r)||r,H=(0,F.$j)()(u=(0,N.ZP)(u=(0,q.EN)((p=l=function(e){function t(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var a=e.apply(this,t)||this;return(0,g.Z)(a,"state",{password:"",isLoading:!1,code:"",qrCodeURI:"",confirm_key:""}),(0,g.Z)(a,"handleInputChange",(function(e){var t;a.setState(((t={})[e.target.name]=e.target.value,t))})),(0,g.Z)(a,"handleCancelClick",(function(e){a.props.history.push("../auth/edit"),e.preventDefault()})),(0,g.Z)(a,"handleSubmit",(function(e){var t=a.props,s=t.dispatch,o=t.intl,i=a.state,n=i.code,r=i.password;a.setState({isLoading:!0}),s((0,T.iO)("totp",n,r)).then((function(){s(j.ZP.success(o.formatMessage(A.mfaConfirmSuccess))),a.props.history.push("../auth/edit")})).catch((function(e){s(j.ZP.error(o.formatMessage(A.confirmFail))),a.setState({isLoading:!1})})),e.preventDefault()})),a}return L(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props,s=t.dispatch,a=t.intl;s((0,T.oJ)("totp")).then((function(t){e.setState({qrCodeURI:t.provisioning_uri,confirm_key:t.key})})).catch((function(e){s(j.ZP.error(a.formatMessage(A.qrFail)))}))},t.prototype.render=function(){var e=this.props.intl,t=this.state,s=t.isLoading,a=t.qrCodeURI,o=t.confirm_key,i=t.password,n=t.code;return(0,_.Z)("div",{className:"security-settings-panel"},void 0,(0,_.Z)(R.NA,{onSubmit:this.handleSubmit,disabled:s},void 0,(0,_.Z)("fieldset",{disabled:!1},void 0,(0,_.Z)(R.H_,{},void 0,(0,_.Z)("div",{className:"security-settings-panel__section-container"},void 0,(0,_.Z)("h2",{},void 0,(0,_.Z)(S.Z,{id:"mfa.mfa_setup_scan_title",defaultMessage:"Scan"})),(0,_.Z)("div",{},void 0,(0,_.Z)(S.Z,{id:"mfa.mfa_setup_scan_description",defaultMessage:"Using your two-factor app, scan this QR code or enter the text key."})),(0,_.Z)("div",{className:"security-settings-panel__qr-code"},void 0,(0,_.Z)(v(),{value:a}),(0,_.Z)("div",{className:"security-settings-panel__confirm-key"},void 0,o))),(0,_.Z)("div",{className:"security-settings-panel__section-container"},void 0,(0,_.Z)("h2",{},void 0,(0,_.Z)(S.Z,{id:"mfa.mfa_setup_verify_title",defaultMessage:"Verify"})),(0,_.Z)(R.oi,{name:"code",label:e.formatMessage(A.codePlaceholder),hint:(0,_.Z)(S.Z,{id:"mfa.mfa_setup.code_hint",defaultMessage:"Enter the code from your two-factor app."}),placeholder:e.formatMessage(A.codePlaceholder),onChange:this.handleInputChange,autoComplete:"off",value:n,disabled:s,required:!0}),(0,_.Z)(O.Z,{name:"password",label:e.formatMessage(A.passwordPlaceholder),hint:(0,_.Z)(S.Z,{id:"mfa.mfa_setup.password_hint",defaultMessage:"Enter your current password to confirm your identity."}),placeholder:e.formatMessage(A.passwordPlaceholder),onChange:this.handleInputChange,value:i,disabled:s,required:!0})))),(0,_.Z)("div",{className:"security-settings-panel__setup-otp__buttons"},void 0,(0,_.Z)(D.Z,{type:"button",className:"button button-secondary cancel",text:e.formatMessage(A.mfa_cancel_button),onClick:this.handleCancelClick,disabled:s}),(0,_.Z)(D.Z,{type:"submit",className:"button button-primary setup",text:e.formatMessage(A.mfa_setup_confirm_button),disabled:s}))))},t}(P.ZP),(0,g.Z)(l,"propTypes",{intl:y().object.isRequired,history:y().object}),u=p))||u)||u)||u}}]);
//# sourceMappingURL=mfa_form-b47b04cd562c61353acf.chunk.js.map