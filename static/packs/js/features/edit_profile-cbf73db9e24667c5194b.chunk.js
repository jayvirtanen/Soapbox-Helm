(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[30],{1140:function(e,t,a){var i=a(547)({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});e.exports=i},1224:function(e,t,a){a(6);var i=a(130),s=a(1140),o=/&(?:amp|lt|gt|quot|#39);/g,l=RegExp(o.source);e.exports=function(e){return(e=i(e))&&l.test(e)?e.replace(o,s):e}},1102:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return G}});var i,s,o,l,n,d=a(1019),r=a(1018),c=a(1224),f=a.n(c),h=(a(1),a(53),a(320)),u=a(3),p=a.n(u),m=a(0),_=a(5),g=a.n(_),b=a(4),Z=a(1797),v=a(1017),y=a(1021),w=a(2),M=a(15),C=a(71),k=a(30),N=a(26),x=a(1253),F=a(8),P=a(28),S=a(12),L=a(10),O=a(1162),T=a(16),E=a(1800),j=a(103),z=a(183),A=a(17),B=a(55),D=(0,w.$j)((function(e){return{displayFqn:(0,B.$X)(e)}}))((function(e){var t=e.account,a=e.displayFqn;return(0,d.Z)("div",{className:"card h-card"},void 0,(0,d.Z)(E.rU,{to:"/@".concat(t.get("acct"))},void 0,(0,d.Z)("div",{className:"card__img"},void 0,(0,d.Z)(j.Z,{alt:"",src:t.get("header")})),(0,d.Z)("div",{className:"card__bar"},void 0,(0,d.Z)("div",{className:"avatar"},void 0,(0,d.Z)(j.Z,{alt:"",className:"u-photo",src:t.get("avatar"),width:"48",height:"48"})),(0,d.Z)("div",{className:"display-name"},void 0,(0,d.Z)("span",{style:{display:"none"}},void 0,t.get("username")),(0,d.Z)("bdi",{},void 0,(0,d.Z)("strong",{className:"emojify p-name"},void 0,t.get("display_name"),t.get("verified")&&(0,d.Z)(z.Z,{}))),(0,d.Z)("span",{},void 0,"@",(0,A.F7)(t,a))))))})),I=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),X=(0,Z.vU)({heading:{id:"column.edit_profile",defaultMessage:"Edit profile"},metaFieldLabel:{id:"edit_profile.fields.meta_fields.label_placeholder",defaultMessage:"Label"},metaFieldContent:{id:"edit_profile.fields.meta_fields.content_placeholder",defaultMessage:"Content"},verified:{id:"edit_profile.fields.verified_display_name",defaultMessage:"Verified users may not update their display name"},success:{id:"edit_profile.success",defaultMessage:"Profile saved!"},error:{id:"edit_profile.error",defaultMessage:"Profile update failed"},bioPlaceholder:{id:"edit_profile.fields.bio_placeholder",defaultMessage:"Tell us about yourself."},displayNamePlaceholder:{id:"edit_profile.fields.display_name_placeholder",defaultMessage:"Name"},view:{id:"snackbar.view",defaultMessage:"View"},birthdayPlaceholder:{id:"edit_profile.fields.birthday_placeholder",defaultMessage:"Your birthday"}}),q=function(e,t){return(0,h.List)(e).setSize(Math.max(e.size,t)).map((function(e){return e||(0,h.Map)({name:"",value:""})}))},G=(s=(0,w.$j)((function(){var e=(0,S.Tm)();return function(t){var a=t.get("me"),i=e(t,a),s=(0,N.UX)(t),o=(0,L.N$)(t.get("instance"));return{account:i,maxFields:t.getIn(["instance","pleroma","metadata","fields_limits","max_fields"],4),verifiedCanEditName:s.get("verifiedCanEditName"),supportsEmailList:o.emailList,supportsBirthdays:o.birthdays}}})),s(o=(0,v.ZP)((n=l=function(e){function t(t){var a=e.call(this,t)||this;(0,r.Z)(a,"state",{isLoading:!1}),(0,r.Z)(a,"makePreviewAccount",(function(){var e=a.props.account;return e.merge((0,h.Map)({header:a.state.header,avatar:a.state.avatar,display_name:a.state.display_name||e.get("username")}))})),(0,r.Z)(a,"getFieldParams",(function(){var e=(0,h.Map)();return a.state.fields.forEach((function(t,a){return e=e.set("fields_attributes[".concat(a,"][name]"),t.get("name")).set("fields_attributes[".concat(a,"][value]"),t.get("value"))})),e})),(0,r.Z)(a,"getParams",(function(){var e=a.state;return Object.assign({discoverable:e.discoverable,bot:e.bot,display_name:e.display_name,note:e.note,avatar:e.avatar_file,header:e.header_file,locked:e.locked,accepts_email_list:e.accepts_email_list,hide_followers:e.hide_network,hide_follows:e.hide_network,hide_followers_count:e.hide_network,hide_follows_count:e.hide_network,birthday:e.birthday?new Date(e.birthday.getTime()-6e4*e.birthday.getTimezoneOffset()).toISOString().slice(0,10):void 0,show_birthday:e.show_birthday},a.getFieldParams().toJS())})),(0,r.Z)(a,"getFormdata",(function(){var e=a.getParams(),t=new FormData;for(var i in e)Boolean(void 0!==e[i]||i.startsWith("fields_attributes"))&&t.append(i,e[i]||"");return t})),(0,r.Z)(a,"handleSubmit",(function(e){var t=a.props,i=t.dispatch,s=t.intl,o=t.account,l=i((0,C.sQ)(a.getFormdata())),n=i((0,M.lU)({block_from_strangers:a.state.stranger_notifications||!1}));a.setState({isLoading:!0}),Promise.all([l,n]).then((function(){a.setState({isLoading:!1}),i(k.ZP.success(s.formatMessage(X.success),s.formatMessage(X.view),"/@".concat(o.get("acct"))))})).catch((function(e){a.setState({isLoading:!1}),i(k.ZP.error(s.formatMessage(X.error)))})),e.preventDefault()})),(0,r.Z)(a,"handleCheckboxChange",(function(e){var t;a.setState(((t={})[e.target.name]=e.target.checked,t))})),(0,r.Z)(a,"handleTextChange",(function(e){var t;a.setState(((t={})[e.target.name]=e.target.value,t))})),(0,r.Z)(a,"handleFieldChange",(function(e,t){return function(i){a.setState({fields:a.state.fields.setIn([e,t],i.target.value)})}})),(0,r.Z)(a,"handleFileChange",(function(e){return function(t){var i=t.target.name,s=(t.target.files||[])[0];(0,O.Z)(s,e).then((function(e){var t,s=e?URL.createObjectURL(e):a.state[i];a.setState(((t={})[i]=s,t["".concat(i,"_file")]=e,t))})).catch(console.error)}})),(0,r.Z)(a,"handleBirthdayChange",(function(e){a.setState({birthday:e})})),(0,r.Z)(a,"handleAddField",(function(){a.setState({fields:a.state.fields.push((0,h.Map)({name:"",value:""}))})})),(0,r.Z)(a,"handleDeleteField",(function(e){return function(){a.setState({fields:q(a.state.fields.delete(e),Math.min(a.props.maxFields,4))})}}));var i=a.props,s=i.account,o=i.maxFields,l=s.getIn(["pleroma","notification_settings","block_from_strangers"]),n=s.getIn(["pleroma","accepts_email_list"]),d=s.getIn(["source","pleroma","discoverable"]),c=s.get("birthday"),u=s.getIn(["source","pleroma","show_birthday"]),p=(0,h.Map)(s).withMutations((function(e){if(e.merge(e.get("source")),e.delete("source"),e.set("fields",q(e.get("fields"),Math.min(o,4))),e.set("stranger_notifications",l),e.set("accepts_email_list",n),e.set("hide_network",function(e){var t=e.get("pleroma");if(!t)return!1;var a=t.toJS(),i=a.hide_followers,s=a.hide_follows,o=a.hide_followers_count,l=a.hide_follows_count;return i&&s&&o&&l}(s)),e.set("discoverable",d),e.set("show_birthday",u),c){var t=new Date(c);e.set("birthday",new Date(t.getTime()+6e4*t.getTimezoneOffset()))}!function(e,t){["display_name","bio"].reduce((function(e,t){return e.set(t,f()(e.get(t)))}),e)}(e)}));return a.state=p.toObject(),a}return I(t,e),t.prototype.render=function(){var e=this,t=this.props,i=t.intl,s=t.maxFields,o=t.account,l=t.verifiedCanEditName,n=t.supportsBirthdays,r=t.supportsEmailList,c=o.get("verified"),f=l||!c;return(0,d.Z)(T.Z,{icon:"user",heading:i.formatMessage(X.heading)},void 0,(0,d.Z)(P.NA,{onSubmit:this.handleSubmit},void 0,(0,d.Z)("fieldset",{disabled:this.state.isLoading},void 0,(0,d.Z)(P.H_,{},void 0,(0,d.Z)(P.oi,{className:f?"":"disabled",label:(0,d.Z)(y.Z,{id:"edit_profile.fields.display_name_label",defaultMessage:"Display name"}),placeholder:i.formatMessage(X.displayNamePlaceholder),name:"display_name",value:this.state.display_name,onChange:this.handleTextChange,disabled:!f,hint:!f&&i.formatMessage(X.verified)}),(0,d.Z)(P.pm,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.bio_label",defaultMessage:"Bio"}),placeholder:i.formatMessage(X.bioPlaceholder),name:"note",autoComplete:"off",value:this.state.note,wrap:"hard",onChange:this.handleTextChange,rows:3}),n&&m.createElement(m.Fragment,null,(0,d.Z)(x.Z,{hint:(0,d.Z)(y.Z,{id:"edit_profile.fields.birthday_label",defaultMessage:"Birthday"}),value:this.state.birthday,onChange:this.handleBirthdayChange}),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.show_birthday_label",defaultMessage:"Show my birthday"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.show_birthday",defaultMessage:"Your birthday will be visible on your profile."}),name:"show_birthday",checked:this.state.show_birthday,onChange:this.handleCheckboxChange})),(0,d.Z)("div",{className:"fields-row"},void 0,(0,d.Z)("div",{className:"fields-row__column fields-row__column-6"},void 0,(0,d.Z)(D,{account:this.makePreviewAccount()})),(0,d.Z)("div",{className:"fields-row__column fields-group fields-row__column-6"},void 0,(0,d.Z)(P.MH,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.header_label",defaultMessage:"Header"}),name:"header",hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.header",defaultMessage:"PNG, GIF or JPG. Will be downscaled to {size}",values:{size:"1920x1080px"}}),onChange:this.handleFileChange(2073600)}),(0,d.Z)(P.MH,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.avatar_label",defaultMessage:"Avatar"}),name:"avatar",hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.avatar",defaultMessage:"PNG, GIF or JPG. Will be downscaled to {size}",values:{size:"400x400px"}}),onChange:this.handleFileChange(16e4)}))),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.locked_label",defaultMessage:"Lock account"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.locked",defaultMessage:"Requires you to manually approve followers"}),name:"locked",checked:this.state.locked,onChange:this.handleCheckboxChange}),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.hide_network_label",defaultMessage:"Hide network"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.hide_network",defaultMessage:"Who you follow and who follows you will not be shown on your profile"}),name:"hide_network",checked:this.state.hide_network,onChange:this.handleCheckboxChange}),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.bot_label",defaultMessage:"This is a bot account"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.bot",defaultMessage:"This account mainly performs automated actions and might not be monitored"}),name:"bot",checked:this.state.bot,onChange:this.handleCheckboxChange}),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.stranger_notifications_label",defaultMessage:"Block notifications from strangers"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.stranger_notifications",defaultMessage:"Only show notifications from people you follow"}),name:"stranger_notifications",checked:this.state.stranger_notifications,onChange:this.handleCheckboxChange}),(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.discoverable_label",defaultMessage:"Allow account discovery"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.discoverable",defaultMessage:"Display account in profile directory and allow indexing by external services"}),name:"discoverable",checked:this.state.discoverable,onChange:this.handleCheckboxChange}),r&&(0,d.Z)(P.XZ,{label:(0,d.Z)(y.Z,{id:"edit_profile.fields.accepts_email_list_label",defaultMessage:"Subscribe to newsletter"}),hint:(0,d.Z)(y.Z,{id:"edit_profile.hints.accepts_email_list",defaultMessage:"Opt-in to news and marketing updates."}),name:"accepts_email_list",checked:this.state.accepts_email_list,onChange:this.handleCheckboxChange})),(0,d.Z)(P.H_,{},void 0,(0,d.Z)("div",{className:"fields-row__column fields-group"},void 0,(0,d.Z)("div",{className:"input with_block_label"},void 0,(0,d.Z)("label",{},void 0,(0,d.Z)(y.Z,{id:"edit_profile.fields.meta_fields_label",defaultMessage:"Profile metadata"})),(0,d.Z)("span",{className:"hint"},void 0,(0,d.Z)(y.Z,{id:"edit_profile.hints.meta_fields",defaultMessage:"You can have up to {count, plural, one {# item} other {# items}} displayed as a table on your profile",values:{count:s}})),this.state.fields.map((function(t,s){return(0,d.Z)("div",{className:"row"},s,(0,d.Z)(P.oi,{placeholder:i.formatMessage(X.metaFieldLabel),value:t.get("name"),onChange:e.handleFieldChange(s,"name")}),(0,d.Z)(P.oi,{placeholder:i.formatMessage(X.metaFieldContent),value:t.get("value"),onChange:e.handleFieldChange(s,"value")}),e.state.fields.size>4&&(0,d.Z)(F.Z,{className:"delete-field",src:a(75),onClick:e.handleDeleteField(s)}))})),this.state.fields.size<s&&(0,d.Z)("div",{className:"actions add-row"},void 0,(0,d.Z)("div",{name:"button",type:"button",role:"presentation",className:"btn button button-secondary",onClick:this.handleAddField},void 0,(0,d.Z)(F.Z,{src:a(1172)}),(0,d.Z)(y.Z,{id:"edit_profile.meta_fields.add",defaultMessage:"Add new item"}))))))),(0,d.Z)("div",{className:"actions"},void 0,(0,d.Z)("button",{name:"button",type:"submit",className:"btn button button-primary"},void 0,(0,d.Z)(y.Z,{id:"edit_profile.save",defaultMessage:"Save"})))))},t}(b.ZP),(0,r.Z)(l,"propTypes",{dispatch:p().func.isRequired,intl:p().object.isRequired,account:g().map,maxFields:p().number,verifiedCanEditName:p().bool,supportsEmailList:p().bool,supportsBirthdays:p().bool}),o=n))||o)||o)}}]);
//# sourceMappingURL=edit_profile-cbf73db9e24667c5194b.chunk.js.map