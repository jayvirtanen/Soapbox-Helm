{"version":3,"file":"packs/js/features/chats/components/chat_panes-9b2910381e9d39e050aa.chunk.js","mappings":"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","sources":["webpack://soapbox-fe/./app/soapbox/features/chats/components/chat_window.js","webpack://soapbox-fe/./app/soapbox/features/chats/components/chat_panes.js"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2,_temp;import\"core-js/modules/web.dom-collections.iterator.js\";import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{injectIntl}from'react-intl';import{connect}from'react-redux';import{Link}from'react-router-dom';import{closeChat,toggleChat}from'soapbox/actions/chats';import Avatar from'soapbox/components/avatar';import HoverRefWrapper from'soapbox/components/hover_ref_wrapper';import IconButton from'soapbox/components/icon_button';import{makeGetChat}from'soapbox/selectors';import{getAcct}from'soapbox/utils/accounts';import{shortNumberFormat}from'soapbox/utils/numbers';import{displayFqn}from'soapbox/utils/state';import ChatBox from'./chat_box';const makeMapStateToProps=()=>{const getChat=makeGetChat();const mapStateToProps=(state,{chatId})=>{const chat=state.getIn(['chats','items',chatId]);return{me:state.get('me'),chat:chat?getChat(state,chat.toJS()):undefined,displayFqn:displayFqn(state)};};return mapStateToProps;};let ChatWindow=(_dec=connect(makeMapStateToProps),_dec(_class=injectIntl(_class=(_temp=_class2=class ChatWindow extends ImmutablePureComponent{constructor(...args){super(...args);_defineProperty(this,\"state\",{content:''});_defineProperty(this,\"handleChatClose\",chatId=>{return e=>{this.props.dispatch(closeChat(chatId));};});_defineProperty(this,\"handleChatToggle\",chatId=>{return e=>{this.props.dispatch(toggleChat(chatId));};});_defineProperty(this,\"handleContentChange\",e=>{this.setState({content:e.target.value});});_defineProperty(this,\"handleInputRef\",el=>{this.inputElem=el;this.focusInput();});_defineProperty(this,\"focusInput\",()=>{if(!this.inputElem)return;this.inputElem.focus();});}componentDidUpdate(prevProps){const oldState=prevProps.windowState;const newState=this.props.windowState;if(oldState!==newState&&newState==='open')this.focusInput();}render(){const{windowState,idx,chat,displayFqn}=this.props;if(!chat)return null;const account=chat.get('account');const right=285*(idx+1)+20;const unreadCount=chat.get('unread');const unreadIcon=/*#__PURE__*/_jsx(\"i\",{className:\"icon-with-badge__badge\"},void 0,shortNumberFormat(unreadCount));const avatar=/*#__PURE__*/_jsx(HoverRefWrapper,{accountId:account.get('id')},void 0,/*#__PURE__*/_jsx(Link,{to:\"/@\".concat(account.get('acct'))},void 0,/*#__PURE__*/_jsx(Avatar,{account:account,size:18})));return/*#__PURE__*/_jsx(\"div\",{className:\"pane pane--\".concat(windowState),style:{right:\"\".concat(right,\"px\")}},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"pane__header\"},void 0,unreadCount>0?unreadIcon:avatar,/*#__PURE__*/_jsx(\"button\",{className:\"pane__title\",onClick:this.handleChatToggle(chat.get('id'))},void 0,\"@\",getAcct(account,displayFqn)),/*#__PURE__*/_jsx(\"div\",{className:\"pane__close\"},void 0,/*#__PURE__*/_jsx(IconButton,{src:require('@tabler/icons/icons/x.svg'),title:\"Close chat\",onClick:this.handleChatClose(chat.get('id'))}))),/*#__PURE__*/_jsx(\"div\",{className:\"pane__content\"},void 0,/*#__PURE__*/_jsx(ChatBox,{chatId:chat.get('id'),onSetInputRef:this.handleInputRef})));}},_defineProperty(_class2,\"propTypes\",{dispatch:PropTypes.func.isRequired,intl:PropTypes.object.isRequired,chatId:PropTypes.string.isRequired,windowState:PropTypes.string.isRequired,idx:PropTypes.number,chat:ImmutablePropTypes.map,me:PropTypes.node,displayFqn:PropTypes.bool}),_temp))||_class)||_class);export{ChatWindow as default};","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2,_temp;import\"core-js/modules/web.dom-collections.iterator.js\";import{List as ImmutableList}from'immutable';import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{FormattedMessage}from'react-intl';import{injectIntl,defineMessages}from'react-intl';import{connect}from'react-redux';import{withRouter}from'react-router-dom';import{createSelector}from'reselect';import{openChat,launchChat,toggleMainWindow}from'soapbox/actions/chats';import{getSettings}from'soapbox/actions/settings';import AccountSearch from'soapbox/components/account_search';import AudioToggle from'soapbox/features/chats/components/audio_toggle';import{shortNumberFormat}from'soapbox/utils/numbers';import ChatList from'./chat_list';import ChatWindow from'./chat_window';const messages=defineMessages({searchPlaceholder:{\"id\":\"chats.search_placeholder\",\"defaultMessage\":\"Start a chat with\\u2026\"}});const getChatsUnreadCount=state=>{const chats=state.getIn(['chats','items']);return chats.reduce((acc,curr)=>acc+Math.min(curr.get('unread',0),1),0);};// Filter out invalid chats\nconst normalizePanes=(chats,panes=ImmutableList())=>panes.filter(pane=>chats.get(pane.get('chat_id')));const makeNormalizeChatPanes=()=>createSelector([state=>state.getIn(['chats','items']),state=>getSettings(state).getIn(['chats','panes'])],normalizePanes);const makeMapStateToProps=()=>{const mapStateToProps=state=>{const normalizeChatPanes=makeNormalizeChatPanes();return{panes:normalizeChatPanes(state),mainWindowState:getSettings(state).getIn(['chats','mainWindow']),unreadCount:getChatsUnreadCount(state)};};return mapStateToProps;};let ChatPanes=(_dec=connect(makeMapStateToProps),_dec(_class=injectIntl(_class=withRouter(_class=(_temp=_class2=class ChatPanes extends ImmutablePureComponent{constructor(...args){super(...args);_defineProperty(this,\"handleClickChat\",chat=>{this.props.dispatch(openChat(chat.get('id')));});_defineProperty(this,\"handleSuggestion\",accountId=>{this.props.dispatch(launchChat(accountId,this.props.history));});_defineProperty(this,\"handleMainWindowToggle\",()=>{this.props.dispatch(toggleMainWindow());});}render(){const{intl,panes,mainWindowState,unreadCount}=this.props;const open=mainWindowState==='open';const mainWindowPane=/*#__PURE__*/_jsx(\"div\",{className:\"pane pane--main pane--\".concat(mainWindowState)},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"pane__header\"},void 0,unreadCount>0&&/*#__PURE__*/_jsx(\"i\",{className:\"icon-with-badge__badge\"},void 0,shortNumberFormat(unreadCount)),/*#__PURE__*/_jsx(\"button\",{className:\"pane__title\",onClick:this.handleMainWindowToggle},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"chat_panels.main_window.title\",defaultMessage:\"Chats\"})),/*#__PURE__*/_jsx(AudioToggle,{})),/*#__PURE__*/_jsx(\"div\",{className:\"pane__content\"},void 0,open&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/_jsx(ChatList,{onClickChat:this.handleClickChat}),/*#__PURE__*/_jsx(AccountSearch,{placeholder:intl.formatMessage(messages.searchPlaceholder),onSelected:this.handleSuggestion}))));return/*#__PURE__*/_jsx(\"div\",{className:\"chat-panes\"},void 0,mainWindowPane,panes.map((pane,i)=>/*#__PURE__*/_jsx(ChatWindow,{idx:i,chatId:pane.get('chat_id'),windowState:pane.get('state')},pane.get('chat_id'))));}},_defineProperty(_class2,\"propTypes\",{intl:PropTypes.object.isRequired,dispatch:PropTypes.func.isRequired,mainWindowState:PropTypes.string,panes:ImmutablePropTypes.list,history:PropTypes.object}),_temp))||_class)||_class)||_class);export{ChatPanes as default};"],"names":["_class","_class2","_temp","ChatWindow","getChat","state","chatId","chat","getIn","me","get","toJS","undefined","displayFqn","_dec","injectIntl","args","content","e","props","dispatch","setState","target","value","el","inputElem","focusInput","focus","componentDidUpdate","prevProps","oldState","windowState","newState","this","render","idx","account","right","unreadCount","unreadIcon","className","avatar","accountId","to","concat","size","style","onClick","handleChatToggle","src","title","handleChatClose","onSetInputRef","handleInputRef","intl","messages","searchPlaceholder","getChatsUnreadCount","reduce","acc","curr","Math","min","normalizePanes","chats","panes","filter","pane","ChatPanes","normalizeChatPanes","mainWindowState","history","open","mainWindowPane","handleMainWindowToggle","id","defaultMessage","onClickChat","handleClickChat","placeholder","formatMessage","onSelected","handleSuggestion","map","i"],"sourceRoot":""}